<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<select id="CodeMng.selectCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		<![CDATA[
		SELECT
		    D.*
		FROM
		(
		    SELECT
		        C.*,
		        TRUNCATE((ROWNUM - 1) / #rowSize#, 0) + 1 AS PAGE
		    FROM
		    (
		        SELECT
		            B.*,
		            (@RNUM := @RNUM + 1) AS ROWNUM,
		            TRUNCATE((TOTAL_ROW_SIZE - 1) / #rowSize#, 0) + 1 AS TOTAL_PAGE_SIZE
		        FROM
		        (
		            SELECT
		                A.title,
		                A.dupmd5,
		                A.depart,
		                A.organ,
		                A.auth_yn,
		                A.no,
		                A.link,
		                A.input_date,
		                A.url,
		                (SELECT COUNT(*) FROM minwon) AS TOTAL_ROW_SIZE
		            FROM minwon A
		            ORDER BY A.no DESC
		        ) B, (SELECT @RNUM := 0) R
		    ) C
		) D
		WHERE PAGE = #targetPage#
		]]>
	</select>
	
	<insert id="CodeMng.insertCode" parameterClass="java.util.HashMap">
		<![CDATA[
		INSERT INTO minwon (no, title, depart, input_date)
		VALUES ((SELECT MAX(no) + 1 FROM minwon m), #code#, #codeName#, now());
		]]>
	</insert>
	
	<update id="CodeMng.updateCode" parameterClass="java.util.HashMap">
		<![CDATA[
		UPDATE minwon
		SET title = #code#, depart = #codeName#, input_date = now()
		WHERE no = #codeGroupId#
		]]>
	</update>
	
	<delete id="CodeMng.deleteCode" parameterClass="java.util.HashMap">
		<![CDATA[
		DELETE FROM minwon
		WHERE no = #codeGroupId#
		]]>
	</delete>
</sqlMap>
