<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<select id="CodeMng.selectCodeList" parameterClass="java.lang.Integer" resultClass="java.util.HashMap">
		<![CDATA[
		SELECT
		    D.*
		FROM
		(
		    SELECT
		        C.*,
		        TRUNCATE((ROWNUM - 1) / 10, 0) + 1 AS PAGE
		    FROM
		    (
		        SELECT
		            B.*,
		            (@RNUM := @RNUM + 1) AS ROWNUM,
		            TRUNCATE((TOTAL_ROW_SIZE - 1) / 10, 0) + 1 AS TOTAL_PAGE_SIZE
		        FROM
		        (
		            SELECT
		                A.CODE_GROUP_ID,
		                A.CODE,
		                A.CODE_NAME,
		                A.LAST_UPDATE_DTIME,
		                (SELECT COUNT(*) FROM CODE) AS TOTAL_ROW_SIZE
		            FROM CODE A
		            ORDER BY A.CODE_GROUP_ID
		        ) B, (SELECT @RNUM := 0) R
		    ) C
		) D
		WHERE PAGE = #targetPage#
		]]>
	</select>
	
	<insert id="CodeMng.insertCode" parameterClass="java.util.HashMap">
		<![CDATA[
		INSERT INTO CODE (CODE_GROUP_ID, CODE, CODE_NAME, LAST_UPDATE_DTIME)
		VALUES (#codeGroupId#, #code#, #codeName#, #lastUpdateDtime#)
		]]>
	</insert>
	
	<update id="CodeMng.updateCode" parameterClass="java.util.HashMap">
		<![CDATA[
		UPDATE CODE
		SET CODE_GROUP_ID = #codeGroupId#, CODE = #code#, CODE_NAME = #codeName#, LAST_UPDATE_DTIME = #lastUpdateDtime#
		WHERE CODE_GROUP_ID = #codeGroupId#
		AND CODE = #code#
		]]>
	</update>
	
	<delete id="CodeMng.deleteCode" parameterClass="java.util.HashMap">
		<![CDATA[
		DELETE FROM CODE
		WHERE CODE_GROUP_ID = #codeGroupId#
		AND CODE = #code#
		]]>
	</delete>
</sqlMap>
